<app-main-header></app-main-header>

<div class="page" fxLayout="row" fxLayoutAlign="center">

    <div class="container">
        
        <div fxLayout="row" fxLayoutAlign="left center" style="width: 225px; margin-right: 1rem;">

            <div>
            <mat-form-field subscriptSizing="dynamic" style="width: 250px; font-size: larger; margin-bottom: 0.5rem;">
                <mat-label>
                <mat-icon>search</mat-icon>
                <!-- Filter by ALL -->
                </mat-label>
                <input matInput [(ngModel)]="filterAll" (keyup)="applyFilter()" #input>
            </mat-form-field>
            </div>

            <div *ngIf="filterAll.length > 0">
            <button color="primary" mat-button (click)="onFilterCleared()">
                <mat-icon>clear</mat-icon>
            </button>
            </div>

        </div>

        <div fxLayout="column" style="width: 250px;">
            <mat-form-field appearance="fill" subscriptSizing="dynamic">
                <mat-label>Filter by categories</mat-label>
                <mat-select [(ngModel)]="selectedCategories" (ngModelChange)="onFilterChanged()" multiple="true">
                    <mat-select-trigger>
                        <span>{{selectedCategories.length}} selected</span>
                    </mat-select-trigger>
                    <mat-option *ngFor="let category of optionsCategory" [value]="category">
                        {{category}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>

        <div fxLayout="column" style="width: 250px;">
            <mat-form-field appearance="fill" subscriptSizing="dynamic">
                <mat-label>Filter by attributes</mat-label>
                <mat-select [(ngModel)]="selectedAttributes" (ngModelChange)="onFilterChanged()" multiple="true">
                    <mat-select-trigger>
                        <span>{{selectedAttributes.length}} selected</span>
                    </mat-select-trigger>
                    <mat-option *ngFor="let attribute of optionsAttribute" [value]="attribute">
                        {{attribute}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>

        <div fxLayout="row" fxLayoutAlign="space-between end" style="margin-top: 10px;">

            <div *ngIf="selectedCategories.length + selectedAttributes.length === 0"></div>

            <div *ngIf="selectedCategories.length + selectedAttributes.length > 0" fxLayout="row wrap" fxLayoutAlign="left center" style="margin-bottom: 25px">

                <mat-chip-set>
                    <mat-chip-option *ngFor="let category of selectedCategories" [selectable]=false [removable]=true (removed)="onCategoryFilterRemoved(category)">
                        <span class="chip-text">{{category}}</span>
                        <mat-icon matChipRemove>cancel</mat-icon>
                    </mat-chip-option>
                </mat-chip-set>
            
                <mat-chip-set>
                    <mat-chip-option *ngFor="let attribute of selectedAttributes" [selectable]=false [removable]=true (removed)="onAttributeFilterRemoved(attribute)">
                        <span class="chip-text">{{attribute}}</span>
                        <mat-icon matChipRemove>cancel</mat-icon>
                    </mat-chip-option>
                </mat-chip-set>

                <button mat-button color="primary" (click)="onAllFiltersRemoved()">Clear all Filters <mat-icon iconPositionEnd>filter_alt_off</mat-icon></button>

            </div>            
      
            <div>
                <div fxLayout="row" fxLayoutAlign="right center">
                    <mat-slide-toggle color="primary" style="margin-right: 10px;" [(ngModel)]="onlyStarter" (ngModelChange)="onFilterChanged()">Only Starter</mat-slide-toggle>
                    <mat-icon fontIcon="swap_vert"></mat-icon>
                    <mat-button-toggle-group hideSingleSelectionIndicator="true" value="{{defaultSort}}" (change)="onSortChanged($event)">
                        <mat-button-toggle value="category" style="font-size: 14px">Category</mat-button-toggle>
                        <mat-button-toggle value="name" style="font-size: 14px">Name</mat-button-toggle>
                    </mat-button-toggle-group>
                </div>                
            </div>

        </div>         

        <table mat-table [dataSource]="dataSource" multiTemplateDataRows matSort class="mat-elevation-z8">

            <!-- Data Columns-->
            <!-- <ng-container *ngFor="let column of columns" matColumnDef="{{column.columnDef}}">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> {{column.header}} </th>
            <td mat-cell *matCellDef="let row" class="{{column.class}}"> {{column.cell(row)}} </td>
            </ng-container> -->

            <!-- Expand Column -->
            <!-- <ng-container matColumnDef="expand">
            <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
            <td mat-cell *matCellDef="let feat">
                <button mat-icon-button aria-label="expand row" (click)="(expandedFeat = expandedFeat === feat ? null : feat); $event.stopPropagation()">
                <mat-icon *ngIf="expandedFeat !== feat">keyboard_arrow_down</mat-icon>
                <mat-icon *ngIf="expandedFeat === feat">keyboard_arrow_up</mat-icon>
                </button>
            </td>
            </ng-container> -->

            <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
            <!-- <ng-container matColumnDef="expandedDetail">
            <td mat-cell *matCellDef="let feat" [attr.colspan]="columnsToDisplayWithExpand.length">
                <div class="item-detail" [@detailExpand]="feat == expandedFeat ? 'expanded' : 'collapsed'">
                    <div *ngIf="feat.explanation.length > 0" class="item-description" [innerHTML]="feat.explanation"></div>
                </div>
            </td>
            </ng-container> -->

            <!-- Name Column -->
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
                <td mat-cell *matCellDef="let element" style="vertical-align: top;">
                    <div style="font-weight: 500; ">{{element.name}}</div>
                    <div *ngIf="element.cost > 1" style="margin-top: 2px; font-style: italic; font-size: smaller; color: grey;">(counts as {{element.cost}})</div>
                    <div *ngIf="element.multi != 1" style="margin-top: 2px; font-style: italic; font-size: smaller; color: grey;">
                        <div *ngIf="element.multi > 1">({{element.multi}} times)</div>
                        <div *ngIf="element.multi < 1">
                            (multiple times)
                        </div>
                    </div> 
                </td>
            </ng-container>

            <!-- Category Column -->
            <ng-container matColumnDef="category">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Category</th>
                <td mat-cell *matCellDef="let element">{{element.categoryText}}</td>
            </ng-container>

            <!-- Prerequisite Column -->
            <ng-container matColumnDef="prerequisite">
                <th mat-header-cell *matHeaderCellDef>Prerequisite</th>
                <td mat-cell *matCellDef="let element">{{element.prerequisite}}</td>
            </ng-container>

            <!-- Explanation Column -->
            <ng-container matColumnDef="explanation">
                <th mat-header-cell *matHeaderCellDef>Feat</th>
                <td mat-cell *matCellDef="let element" style="padding-top: 10px; padding-bottom: 10px;">
                    <div style="font-weight: 500; font-size: larger; margin-bottom: 3px;" fxLayout="row" fxLayoutAlign="space-between">
                        <div>
                            <span>{{element.name}}</span>
                            <span *ngIf="element.cost > 1"> ({{element.cost}})</span>
                        </div>
                        <div style="font-size: smaller; color: gray; text-align: right;">
                            <span>{{element.category}}</span>
                            <span *ngIf="element.subcategory.length > 0">: {{element.subcategory}}</span>
                        </div>                        
                    </div>
                    <div *ngIf="element.prerequisite.length > 0" style="margin-bottom: 5px; font-style: italic; color: darkgoldenrod;">Prerequisite: {{element.prerequisite}}</div>
                    <div [innerHTML]="element.explanation"></div>
                    <div *ngIf="element.multi != 1" style="margin-top: 10px; color: darkgreen;">
                        <div *ngIf="element.multi > 1" style="font-weight: 500;">You can select this feat {{element.multi}} times.</div>
                        <div *ngIf="element.multi < 1" style="font-weight: 500;">You can select this feat multiple times.</div>
                        <div *ngIf="element.multiAppendix.length > 0">{{element.multiAppendix}}</div>                
                    </div>
                    <div fxLayout="row wrap" fxLayoutAlign="space-between start">
                        <mat-chip-set>
                            <mat-chip *ngIf="element.cost > 1" style="background: rgba(218, 167, 248, 0.4);" matTooltip="This feat counts as {{element.cost}} feats. This means you have to invest {{element.cost}} ability score improvements (ASI) instead of the usual 1.">
                              <span class="chip-text">Costs {{element.cost}}</span>
                            </mat-chip>
                            <mat-chip *ngIf="element.starter === true" style="background: rgb(210, 224, 247);" matTooltip="This feat can't be taken at character creation.">
                                <span class="chip-text">Starting Feat</span>
                            </mat-chip>
                        </mat-chip-set>

                        <div *ngIf="!sharable">
                            <button mat-icon-button class="normal-icon-button" style="color: gray" (click)="onCopyFeatLink(element)">
                                <mat-icon>link</mat-icon>
                            </button>
                        </div>
                        <div *ngIf="sharable">
                            <button mat-icon-button class="normal-icon-button" style="color: gray" (click)="onShareFeat(element)">
                                <mat-icon>share</mat-icon>
                            </button>
                        </div>
                    </div>                

                    <!-- <div *ngIf="element.cost > 1" style="margin-top: 10px; font-style: italic; color: darkmagenta;">This feat counts as {{element.cost}} feats. This means you have to invest {{element.cost}} ability score improvements (ASI) instead of the usual 1.</div>
                    <div *ngIf="element.starter === false" style="margin-top: 10px; font-style: italic; color: darkred;">This feat can't be taken at character creation.</div>              -->
                </td>
            </ng-container>

            <!-- <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr> -->
            <tr mat-row *matRowDef="let element; columns: columnsToDisplay;">
            </tr>
            <!-- <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr> -->

            <!-- Row shown when there is no matching data. -->
            <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" [attr.colspan]="columnsToDisplay.length">No data matching the filter {{filterAll}}</td>
            </tr>

        </table>


    </div>

</div>
  
  