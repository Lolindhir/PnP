<div fxLayout="row" fxLayoutAlign="center">
  <div *ngIf="!loading" class="container">

    <div fxLayout="row" fxLayoutAlign="space-between">

      <div *ngIf="settings.characterMode && characterData.selectedCharacter != undefined && characterManagementActivated">
        <button mat-icon-button color="primary" [matMenuTriggerFor]="menu" style="font-size: large"><mat-icon>menu</mat-icon> {{characterData.selectedCharacter.mode}}</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item *ngFor="let mode of getModeOptions()" (click)="onModeChanged(mode)">{{mode}}</button>
        </mat-menu>
      </div>

      <div fxLayout="row" fxLayoutAlign="end" style="width: 100%">

        <div *ngIf="settings.characterMode && characterManagementActivated">
          <button color="primary" mat-button (click)="openCharacterDialog()" matTooltip="Character Management" matTooltipShowDelay="{{tooltipDelay}}"
            style="overflow: hidden; white-space: nowrap; text-overflow: ellipsis;"
            [style.max-width.px]="screenWidth - 220">
            <mat-icon>manage_accounts</mat-icon>
            <span>
              {{characterData.selectedCharacter != undefined ? characterData.selectedCharacter.name : '&lt;choose character&gt;'}}
            </span>            
          </button>
        </div>      
  
        <button color="primary" mat-icon-button (click)="openSettingsDialog()" matTooltip="Settings" matTooltipShowDelay="{{tooltipDelay}}">
          <mat-icon>settings</mat-icon>
        </button>

      </div>      

    </div>

    <mat-expansion-panel hideToggle (opened)="advancedFiltersPanelOpen = true"
      (closed)="advancedFiltersPanelOpen = false">
      <mat-expansion-panel-header>
        <mat-panel-title>
          Filters
        </mat-panel-title>
        <mat-panel-description>
          Press to {{advancedFiltersPanelOpen ? 'hide' : 'show'}}
        </mat-panel-description>
      </mat-expansion-panel-header>


      <div fxLayout="row wrap" fxLayoutAlign="center center">
      <!-- <div fxLayout="row wrap" fxLayoutAlign="left" fxLayoutAlign.lt-sm="space-evenly center"> -->

        <div fxLayout="column" class="filter-select">
          <div>Spell Level</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersLevel"
              (ngModelChange)="addFilterMulti(optionsLevel, selectedFiltersLevel)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersLevel.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsLevel" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Class</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersClass"
              (ngModelChange)="addFilterMulti(optionsClass, selectedFiltersClass)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersClass.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsClass" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Category</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersTag"
              (ngModelChange)="addFilterMulti(optionsTag, selectedFiltersTag)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersTag.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsTag" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Preset</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersPreset"
              (ngModelChange)="addFilterMulti(optionsPreset, selectedFiltersPreset)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersPreset.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsPreset" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Casting Time</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersCastingTime"
              (ngModelChange)="addFilterMulti(optionsCastingTime, selectedFiltersCastingTime)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersCastingTime.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsCastingTime" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Attack\Save</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersAttackSave"
              (ngModelChange)="addFilterMulti(optionsAttackSave, selectedFiltersAttackSave)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersAttackSave.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsAttackSave" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-button-select">
          <div style="text-align: center;">Ritual <img class="image" src={{images.spellRitual}}></div>
          <div style="text-align: center;">
            <mat-button-toggle-group multiple="true" [(ngModel)]="selectedFiltersRitual">
              <mat-button-toggle value="true" (click)="addFilterToggle(optionsRitual, true)">Yes</mat-button-toggle>
              <mat-button-toggle value="false" (click)="addFilterToggle(optionsRitual, false)">No</mat-button-toggle>
            </mat-button-toggle-group>
          </div>
        </div>

        <div fxLayout="column" class="filter-button-select">
          <div style="text-align: center;">Concentration <img class="image" src={{images.spellConcentration}}></div>
          <div style="text-align: center;">
            <mat-button-toggle-group multiple="true" [(ngModel)]="selectedFiltersConcentration">
              <mat-button-toggle value="true" (click)="addFilterToggle(optionsConcentration, true)">Yes
              </mat-button-toggle>
              <mat-button-toggle value="false" (click)="addFilterToggle(optionsConcentration, false)">No
              </mat-button-toggle>
            </mat-button-toggle-group>
          </div>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Targets</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersAffectedTargets"
              (ngModelChange)="addFilterMulti(optionsAffectedTargets, selectedFiltersAffectedTargets)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersAffectedTargets.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsAffectedTargets" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Range</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersRange"
              (ngModelChange)="addFilterMulti(optionsRange, selectedFiltersRange)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersRange.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsRange" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Subclass</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersSubclass"
              (ngModelChange)="addFilterMulti(optionsSubclass, selectedFiltersSubclass)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersSubclass.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsSubclass" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Source</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersSource"
              (ngModelChange)="addFilterMulti(optionsSource, selectedFiltersSource)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersSource.length}} selected</span>
              </mat-select-trigger>
              <mat-optgroup *ngFor="let group of optionsSourceGroups" [label]="group.name">
                <mat-option *ngFor="let filter of group.filters" [value]="filter">
                  {{filter.displayTextList}}</mat-option>
              </mat-optgroup>
            </mat-select>
          </mat-form-field>
        </div>

      </div>


      <div *ngIf="screenSm" class="medium-gap">
        <mat-divider></mat-divider>
      </div>


      <div *ngIf="!screenSm" class="big-gap" fxLayout="row" fxLayoutAlign="center">
        <button mat-raised-button color="primary" style="vertical-align: center;"
          (click)="showAdvancedFilters = !showAdvancedFilters">
          <span *ngIf="showAdvancedFilters">Hide Advanced Filters</span>
          <span *ngIf="!showAdvancedFilters">Show Advanced Filters</span>
        </button>
      </div>

      <div *ngIf="showAdvancedFilters || screenSm" fxLayout="row wrap" fxLayoutAlign="center center">
      <!-- <div *ngIf="showAdvancedFilters || screenSm" fxLayout="row wrap" fxLayoutAlign="left"
        fxLayoutAlign.lt-sm="space-evenly center"> -->

        <div fxLayout="column" class="filter-select">
          <div>Spell School</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersSchool"
              (ngModelChange)="addFilterMulti(optionsSchool, selectedFiltersSchool)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersSchool.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsSchool" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Damage Type</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersDamageType"
              (ngModelChange)="addFilterMulti(optionsDamageType, selectedFiltersDamageType)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersDamageType.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsDamageType" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-button-select">
          <div style="text-align: center;">Casting Ability</div>
          <div style="text-align: center;">
            <mat-button-toggle-group multiple="true" [(ngModel)]="selectedFiltersSpellMod">
              <mat-button-toggle value="true" (click)="addFilterToggle(optionsSpellMod, true)">Yes</mat-button-toggle>
              <mat-button-toggle value="false" (click)="addFilterToggle(optionsSpellMod, false)">No
              </mat-button-toggle>
            </mat-button-toggle-group>
          </div>
        </div>

        <div fxLayout="column" class="filter-button-select">
          <div style="text-align: center;">Upcastable <img class="image" src={{images.spellArrow}}></div>
          <div style="text-align: center;">
            <mat-button-toggle-group multiple="true" [(ngModel)]="selectedFiltersUpcastable">
              <mat-button-toggle value="true" (click)="addFilterToggle(optionsUpcastable, true)">Yes</mat-button-toggle>
              <mat-button-toggle value="false" (click)="addFilterToggle(optionsUpcastable, false)">No
              </mat-button-toggle>
            </mat-button-toggle-group>
          </div>
        </div>

        <div fxLayout="column" class="filter-button-select">
          <div style="text-align: center;">Only Caster</div>
          <div style="text-align: center;">
            <mat-button-toggle-group multiple="true" [(ngModel)]="selectedFiltersTargetCaster">
              <mat-button-toggle value="true" (click)="addFilterToggle(optionsTargetCaster, true)">Yes</mat-button-toggle>
              <mat-button-toggle value="false" (click)="addFilterToggle(optionsTargetCaster, false)">No
              </mat-button-toggle>
            </mat-button-toggle-group>
          </div>
        </div>

        <div fxLayout="column" class="filter-button-select">
          <div style="text-align: center;">Verbal (V)</div>
          <div style="text-align: center;">
            <mat-button-toggle-group multiple="true" [(ngModel)]="selectedFiltersComponentV">
              <mat-button-toggle value="true" (click)="addFilterToggle(optionsComponentV, true)">Yes</mat-button-toggle>
              <mat-button-toggle value="false" (click)="addFilterToggle(optionsComponentV, false)">No
              </mat-button-toggle>
            </mat-button-toggle-group>
          </div>
        </div>

        <div fxLayout="column" class="filter-button-select">
          <div style="text-align: center;">Somatic (S)</div>
          <div style="text-align: center;">
            <mat-button-toggle-group multiple="true" [(ngModel)]="selectedFiltersComponentS">
              <mat-button-toggle value="true" (click)="addFilterToggle(optionsComponentS, true)">Yes</mat-button-toggle>
              <mat-button-toggle value="false" (click)="addFilterToggle(optionsComponentS, false)">No
              </mat-button-toggle>
            </mat-button-toggle-group>
          </div>
        </div>

        <div fxLayout="column" class="filter-button-select">
          <div style="text-align: center;">Material (M)</div>
          <div style="text-align: center;">
            <mat-button-toggle-group multiple="true" [(ngModel)]="selectedFiltersComponentM">
              <mat-button-toggle value="true" (click)="addFilterToggle(optionsComponentM, true)">Yes</mat-button-toggle>
              <mat-button-toggle value="false" (click)="addFilterToggle(optionsComponentM, false)">No
              </mat-button-toggle>
            </mat-button-toggle-group>
          </div>
        </div>

        <div fxLayout="column" class="filter-button-select">
          <div style="text-align: center;">Value <img class="image" src={{images.spellCoins}}></div>
          <div style="text-align: center;">
            <mat-button-toggle-group multiple="true" [(ngModel)]="selectedFiltersMaterialValue">
              <mat-button-toggle value="true" (click)="addFilterToggle(optionsMaterialValue, true)">Yes
              </mat-button-toggle>
              <mat-button-toggle value="false" (click)="addFilterToggle(optionsMaterialValue, false)">No
              </mat-button-toggle>
            </mat-button-toggle-group>
          </div>
        </div>

        <div fxLayout="column" class="filter-button-select">
          <div style="text-align: center;">M consumed <img class="image" src={{images.spellCoins}}></div>
          <div style="text-align: center;">
            <mat-button-toggle-group multiple="true" [(ngModel)]="selectedFiltersMaterialConsumed">
              <mat-button-toggle value="true" (click)="addFilterToggle(optionsMaterialConsumed, true)">Yes
              </mat-button-toggle>
              <mat-button-toggle value="false" (click)="addFilterToggle(optionsMaterialConsumed, false)">No
              </mat-button-toggle>
            </mat-button-toggle-group>
          </div>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Required Save</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersSave"
              (ngModelChange)="addFilterMulti(optionsSave, selectedFiltersSave)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersSave.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsSave" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Attack Type</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersAttackType"
              (ngModelChange)="addFilterMulti(optionsAttackType, selectedFiltersAttackType)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersAttackType.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsAttackType" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Duration</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersDuration"
              (ngModelChange)="addFilterMulti(optionsDuration, selectedFiltersDuration)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersDuration.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsDuration" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Condition</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersCondition"
              (ngModelChange)="addFilterMulti(optionsCondition, selectedFiltersCondition)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersCondition.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsCondition" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Single Class</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersSingleClass"
              (ngModelChange)="addFilterMulti(optionsSingleClass, selectedFiltersSingleClass)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersSingleClass.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsSingleClass" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Must-Class</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersMustClass"
              (ngModelChange)="addFilterMulti(optionsMustClass, selectedFiltersMustClass)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersMustClass.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsMustClass" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Not this Class</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersNotClass"
              (ngModelChange)="addFilterMulti(optionsNotClass, selectedFiltersNotClass)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersNotClass.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsNotClass" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Single Category</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersSingleTag"
              (ngModelChange)="addFilterMulti(optionsSingleTag, selectedFiltersSingleTag)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersSingleTag.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsSingleTag" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Must-Category</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersMustTag"
              (ngModelChange)="addFilterMulti(optionsMustTag, selectedFiltersMustTag)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersMustTag.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsMustTag" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div fxLayout="column" class="filter-select">
          <div>Not this Category</div>
          <mat-form-field appearance="fill">
            <mat-select [(ngModel)]="selectedFiltersNotTag"
              (ngModelChange)="addFilterMulti(optionsNotTag, selectedFiltersNotTag)" multiple="true">
              <mat-select-trigger>
                <span class="filter-selection-number">{{selectedFiltersNotTag.length}} selected</span>
              </mat-select-trigger>
              <mat-option *ngFor="let filter of optionsNotTag" [value]="filter">
                {{filter.displayTextList}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>        

        <!-- <div fxLayout="column" class="filter-button-select">
          <div style="text-align: center;">Tags</div>
          <div style="text-align: center;">
            <mat-slide-toggle [(ngModel)]="showTags" color="primary">
            </mat-slide-toggle>
          </div>
        </div>

        <div class="Block">
          <label id="lbl">Test </label>
          <input type='file' (change)="fileChanged($event)">    
        </div> -->

      </div>

    </mat-expansion-panel>


    <div class="big-top-gap" style="margin-bottom: -1rem;" *ngIf="filters.length > 0">

      <mat-chip-list>
        <mat-chip class="spell-class-chip" *ngFor="let filter of filters" [selectable]=false [removable]=true
          (removed)="onFilterRemoved(filter)" [matTooltip]="filter.tooltip">
          {{filter.displayText}}
          <mat-icon matChipRemove>cancel</mat-icon>
        </mat-chip>
      </mat-chip-list>

      <button mat-button color="primary" (click)="onAllFiltersRemoved()">Clear all Filters <mat-icon>filter_alt_off</mat-icon></button>

    </div>    
        

    <div fxLayout="row wrap" fxLayoutAlign="left center" class="big-top-gap">

      <div fxLayout="row" fxLayoutAlign="left center" style="width: 225px; margin-right: 1rem;">

        <div>
          <mat-form-field appearance="legacy" style="width: 160px; font-size: larger; margin-left: 0.5rem;">
            <mat-label>
              <mat-icon>search</mat-icon>
              <!-- Filter by Name -->
            </mat-label>
            <input matInput name="name" [(ngModel)]="filterName" (keyup)="onChange()">
          </mat-form-field>
        </div>

        <div *ngIf="filterName.length > 0">
          <button color="primary" mat-button (click)="onNameFilterCleared()">
            <mat-icon>clear</mat-icon>
          </button>
        </div>

      </div>

      <div *ngIf="settings.showRandomControls" fxLayout="row" style='padding-bottom: 10px;'>

        <div>
          <button mat-raised-button [matMenuTriggerFor]="menu">{{stringOfRandomSpells}}</button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="onRandomNumberChanged(0)">0</button>
            <button mat-menu-item (click)="onRandomNumberChanged(1)">1</button>
            <button mat-menu-item (click)="onRandomNumberChanged(2)">2</button>
            <button mat-menu-item (click)="onRandomNumberChanged(3)">3</button>
            <button mat-menu-item (click)="onRandomNumberChanged(4)">4</button>
            <button mat-menu-item (click)="onRandomNumberChanged(5)">5</button>
            <button mat-menu-item (click)="onRandomNumberChanged(6)">6</button>
            <button mat-menu-item (click)="onRandomNumberChanged(7)">7</button>
            <button mat-menu-item (click)="onRandomNumberChanged(8)">8</button>
            <button mat-menu-item (click)="onRandomNumberChanged(9)">9</button>
            <button mat-menu-item (click)="onRandomNumberChanged(10)">10</button>
          </mat-menu>
        </div>

        <div *ngIf="numberOfRandomSpells > 0">
          <button color="primary" mat-button (click)="onRandomNumberChanged(numberOfRandomSpells)">
            <mat-icon>autorenew</mat-icon>
          </button>
        </div>

      </div>

      <div *ngIf="!settings.characterMode || characterData.selectedCharacter === undefined" fxFlexAlign="end" style='margin-left: auto'>
        <div>{{spellsFiltered.length}}
          {{spellsFiltered.length === 1 ? 'spell' : 'spells'}}</div>
      </div>

    </div>

    <div *ngIf="settings.characterMode && characterData.selectedCharacter != undefined && characterData.selectedCharacter.mode === ModeOption.AddRemove && filters.length > 0" fxLayout="row wrap" fxLayoutAlign="start"> 
  
      <div>
        <button color="primary" mat-button (click)="onAddAll()" matTooltip="Add all filtered to known spells" matTooltipShowDelay="{{tooltipDelay}}">
          <mat-icon>add_circle</mat-icon>
          <span>
            Add Filtered
          </span>
        </button>
      </div>

      <div>
        <button color="primary" mat-button (click)="onRemoveAll()" matTooltip="Remove all filtered from known spells" matTooltipShowDelay="{{tooltipDelay}}">
          <mat-icon>remove_circle</mat-icon>
          <span>
            Remove Filtered
          </span>
        </button>
      </div>

    </div>

    <div *ngIf="settings.characterMode && characterData.selectedCharacter != undefined" fxLayout="row wrap" fxLayoutAlign="space-between">

      <div *ngIf="characterData.selectedCharacter.mode === ModeOption.Overview" fxLayout="row wrap" fxLayoutAlign="start"> 
  
        <div *ngIf="showTotalKnown()" fxLayout="row" fxLayoutAlign="start center" class="total">
          <div><mat-icon [ngStyle]="{'color' : knownHasError() ? 'red' : ''}" color="primary">bookmark</mat-icon></div>
          <div [ngStyle]="{'color' : knownHasError() ? 'red' : ''}">{{getKnownCount(true, false) + getKnownCount(false, false)}}</div>
        </div>
        <div *ngIf="characterData.selectedCharacter.alwaysSpells.length > 0" fxLayout="row" fxLayoutAlign="start center" class="total">
          <div><mat-icon color="primary">star</mat-icon></div>
          <div>{{characterData.selectedCharacter.alwaysSpells.length}}</div>
        </div>
        <div *ngIf="characterData.selectedCharacter.limitedSpells.length > 0" fxLayout="row" fxLayoutAlign="start center" class="total">
          <div><mat-icon color="primary">repeat_one_on</mat-icon></div>
          <div>{{characterData.selectedCharacter.limitedSpells.length}}</div>
        </div>
        <div *ngIf="characterData.selectedCharacter.ritualSpells.length > 0" fxLayout="row" fxLayoutAlign="start center" class="total">
          <div><mat-icon color="primary">menu_book</mat-icon></div>
          <div>{{characterData.selectedCharacter.ritualSpells.length}}</div>
        </div>
        <div *ngIf="showTotalPrepared()" fxLayout="row" fxLayoutAlign="start center" class="total">
          <div><mat-icon [ngStyle]="{'color' : preparedHasError() ? 'red' : ''}" color="primary">label</mat-icon></div>
          <div [ngStyle]="{'color' : preparedHasError() ? 'red' : ''}">{{getPreparationCount(true, false) + getPreparationCount(false, false)}}</div>
        </div>        
  
      </div>

      <div *ngIf="characterData.selectedCharacter.mode === ModeOption.AddRemove" fxLayout="row wrap" fxLayoutAlign="start">

        <div *ngIf="characterData.selectedCharacter.knownCantripCasting" fxLayout="row" fxLayoutAlign="start center" class="total">
          <div><mat-icon [ngStyle]="{'color' : knownCantripsHaveError() ? 'red' : ''}" color="primary">bookmark</mat-icon></div>
          <div [ngStyle]="{'color' : knownCantripsHaveError() ? 'red' : ''}">Cantrips: {{getKnownCount(true, false)}}/{{getKnownCount(true, true)}}</div>
        </div>

        <div *ngIf="characterData.selectedCharacter.knownCasting" fxLayout="row" fxLayoutAlign="start center" class="total">
          <div><mat-icon [ngStyle]="{'color' : knownSpellsHaveError() ? 'red' : ''}" color="primary">bookmark</mat-icon></div>
          <div [ngStyle]="{'color' : knownSpellsHaveError() ? 'red' : ''}">Spells {{getKnownCount(false, false)}}/{{getKnownCount(false, true)}}</div>
        </div>

      </div>

      <div *ngIf="characterData.selectedCharacter.mode === ModeOption.Prep" fxLayout="row wrap" fxLayoutAlign="start">

        <div *ngIf="characterData.selectedCharacter.preparedCantripCasting" fxLayout="row" fxLayoutAlign="start center" class="total">
          <div><mat-icon [ngStyle]="{'color' : preparedCantripsHaveError() ? 'red' : ''}" color="primary">label</mat-icon></div>
          <div [ngStyle]="{'color' : preparedCantripsHaveError() ? 'red' : ''}">Cantrips: {{getPreparationCount(true, false)}}/{{getPreparationCount(true, true)}}</div>
        </div>

        <div *ngIf="characterData.selectedCharacter.preparedCasting" fxLayout="row" fxLayoutAlign="start center" class="total">
          <div><mat-icon [ngStyle]="{'color' : preparedSpellsHaveError() ? 'red' : ''}" color="primary">label</mat-icon></div>
          <div [ngStyle]="{'color' : preparedSpellsHaveError() ? 'red' : ''}">Spells {{getPreparationCount(false, false)}}/{{getPreparationCount(false, true)}}</div>
        </div>

      </div>

      <div *ngIf="characterData.selectedCharacter.mode === ModeOption.Session" fxLayout="row wrap" fxLayoutAlign="start"> 
  
        <div *ngIf="characterData.selectedCharacter.limitedSpells.length > 0">
          <button color="primary" mat-button (click)="onRefreshUsed()" matTooltip="Refresh used spells" matTooltipShowDelay="{{tooltipDelay}}">
            <mat-icon>auto_mode</mat-icon>
            <span>
              Refresh ({{characterData.selectedCharacter.usedSpells.length}})
            </span>
          </button>
        </div>
  
      </div>

      <div fxLayout="row" fxLayoutAlign="end end">
        <div>{{spellsFiltered.length}} {{spellsFiltered.length === 1 ? 'spell' : 'spells'}}</div>
      </div>

    </div>
    

    <div class="big-top-gap" *ngIf="spellsFiltered.length === 0" style="font-style: italic; text-align: center;">- No
      matching spells found. Check the filter settings. -</div>

    <mat-accordion #expansionAccordion hideToggle="false" multi="false" class="border-without-increase" style="display: block; border-color: red; border-width: 2px;"
    [ngStyle]="{'border-style' : showRedBorder() ? 'solid' : ''}">

      <mat-expansion-panel #panel id="panel{{i}}" *ngFor="let spell of spellsToShow; let i = index"
        [expanded]="i === expandedPanelIndex" (opened)="onSpellExpansionPanelOpened(i)"
        (closed)="onSpellExpansionPanelClosed(i)"
        [disabled]="greyOutUsed(spell)"
        [style.backgroundColor]="highlightSpell(spell)">

        <!-- Template for icons next to the spell name -->
        <ng-template #NameIcons>
          <div *ngIf="spell.ritual" class="spell-expansion-icon" matTooltip="{{spell.ritualTooltip}}"
              matTooltipShowDelay="{{tooltipDelay}}">
            <span *ngIf="!greyOutUsed(spell)"><img class="image" src={{images.spellRitual}}></span>
            <span *ngIf="greyOutUsed(spell)"><img class="image" src={{images.spellRitualGrey}}></span>
          </div>
          <div *ngIf="spell.concentration" class="spell-expansion-icon"
              matTooltip="{{spell.concentrationTooltip}}" matTooltipShowDelay="{{tooltipDelay}}">
            <span *ngIf="!greyOutUsed(spell)"><img class="image" src={{images.spellConcentration}}></span>
            <span *ngIf="greyOutUsed(spell)"><img class="image" src={{images.spellConcentrationGrey}}></span>
          </div>
          <div *ngIf="spell.componentsValue || spell.componentsConsumed" class="spell-expansion-icon"
              matTooltip="{{spell.materialTooltip}}" matTooltipShowDelay="{{tooltipDelay}}">
            <span *ngIf="!greyOutUsed(spell)"><img class="image" src={{images.spellCoins}}></span>
            <span *ngIf="greyOutUsed(spell)"><img class="image" src={{images.spellCoinsGrey}}></span>
          </div>
        </ng-template>

        <!-- Template for first column -->
        <ng-template #FirstColumn>
          <div fxLayout="row">
            <div class="spell-expansion-header spell-expansion-name">
              {{spell.name}}
            </div>
            <ng-template [ngTemplateOutlet]="NameIcons"></ng-template>
          </div>
          <div class="spell-expansion-header spell-expansion-extra">
            <div *ngIf="!showColumnLevel">
              <span *ngIf="spell.upcastable" matTooltip="{{spell.upcastableTooltip}}" matTooltipShowDelay="{{tooltipDelay}}">
                <img class="image" style="max-height: 9px;" src={{images.spellArrowGrey}}>
              </span>{{spell.smallDisplay}}
            </div>
            <div *ngIf="showColumnLevel">
              {{spell.school}} - {{spell.componentsDisplayList}}
            </div>
          </div>
        </ng-template>

        <!-- Template for spell range -->
        <ng-template #SpellRange>
          <span *ngIf="!spell.range.containsAsset">{{spell.range.displayTextComplete}}</span>
          <span *ngIf="spell.range.containsAsset">{{spell.range.displayTextPart1}}<img class="image" src={{spell.range.assetPath}} matTooltip="{{spell.range.assetTooltip}}" matTooltipShowDelay="{{tooltipDelay}}">{{spell.range.displayTextPart2}}</span>
        </ng-template>  

        <mat-expansion-panel-header>

          <div *ngIf="i != expandedPanelIndex" fxLayout="row" fxLayoutAlign="space-between" style="width: 100%;">          

            <!-- 1st row: name -->
            <!-- <div fxLayout="column" style="width: 0px;">

              <div fxLayout="row" [style.width.px]="expansionPanelWidth < 325 ? expansionPanelWidth - 75 : 250">
                <div class="spell-expansion-header spell-expansion-name"
                  [style.max-width.px]="expansionPanelWidth < 325 ? expansionPanelWidth - 100 : 225">
                  {{spell.name}}
                </div>
                <ng-template [ngTemplateOutlet]="NameIcons"></ng-template>
              </div>
              <div class="spell-expansion-header spell-expansion-extra"
                [style.width.px]="expansionPanelWidth < 325 ? expansionPanelWidth - 50 : 275">
                <div *ngIf="!screenSm">{{spell.smallDisplay}}</div>
                <div *ngIf="screenSm">
                  {{spell.school}} - {{spell.componentsDisplayList}}
                </div>
              </div>
              
            </div> -->

            <!-- 1st row: name -->
            <div fxLayout="column" style="width: 250px;">

              <ng-template [ngTemplateOutlet]="FirstColumn"></ng-template>
              
            </div>

            <!-- 2nd row: level -->
            <div *ngIf="showColumnLevel" class="spell-expansion-properties" style="width: 75px;">
              {{spell.levelDisplay}}
              <span *ngIf="spell.upcastable" matTooltip="{{spell.upcastableTooltip}}" matTooltipShowDelay="{{tooltipDelay}}">
                <img class="image" style="max-height: 10px;" src={{images.spellArrow}}>
              </span>
            </div>

            <!-- 3rd row: casting time -->
            <div *ngIf="showColumnCastingTime" class="spell-expansion-properties" style="width: 115px;">
              {{spell.castingTimeDisplayList}}
              <span *ngIf="spell.ritual" matTooltip="{{spell.ritualTooltip}}" matTooltipShowDelay="{{tooltipDelay}}">
                <img class="image" src={{images.spellRitual}}>
              </span>
            </div>

            <!-- 4th row: range -->
            <div *ngIf="showColumnRange" class="spell-expansion-properties" style="width: 150px;">
              <ng-template [ngTemplateOutlet]="SpellRange"></ng-template>
            </div>

            <!-- 5th row: targets -->
            <ng-template #Targets>
              <span *ngFor="let target of spell.targetsDisplay; let firstElement = first; let lastElement = last">
                <span *ngIf="firstElement"><img class="image" src={{images.spellTarget}}></span>
                {{target.displayText}}
                <span *ngIf="target.upcastableAsset" matTooltip="{{spell.upcastableTooltip}}" matTooltipShowDelay="{{tooltipDelay}}">
                  <img class="image" style="max-height: 10px;" src={{images.spellArrow}}>
                </span>
                <span *ngIf="!lastElement">& </span>
              </span>
            </ng-template> 
            
            <!-- if "cannot also target caster"-->
            <div *ngIf="showColumnFlex && !spell.canAlsoTargetCaster" class="spell-expansion-properties" style="width: 150px;">          
              <ng-template [ngTemplateOutlet]="Targets"></ng-template>
            </div>
            <!-- if "can also target caster"-->
            <div *ngIf="showColumnFlex && spell.canAlsoTargetCaster" class="spell-expansion-propertiesSpecial" fxLayout="column" style="width: 150px;">           
              <div class="spell-expansion-header">
                <ng-template [ngTemplateOutlet]="Targets"></ng-template>
              </div>
              <div class="spell-expansion-extra">
                (can target Caster)
              </div>  
            </div>       

                
              <!-- Duration -->
              <!-- <span *ngIf="spell.concentration" matTooltip="{{spell.concentrationTooltip}}"
                matTooltipShowDelay="{{tooltipDelay}}">
                <img class="image" src={{images.spellConcentration}}>
              </span>
              {{spell.durationDisplayList}} -->
              <!-- Components -->
              <!-- {{spell.componentsDisplayList}}
              <span *ngIf="spell.componentsValue || spell.componentsConsumed" matTooltip="{{spell.materialTooltip}}"
                matTooltipShowDelay="{{tooltipDelay}}">
                <img class="image" src={{images.spellCoins}}>
              </span> -->

            <!-- last row: tags -->
            <div *ngIf="showColumnTags" class="spell-expansion-properties" style="width: 120px; margin-right: 15px; text-align: end;">
              <span *ngFor="let tag of spell.tags" class="dot" [style.color]="tag.fontColor" [style.background]="tag.colorCode" matTooltip="{{tag.name}}">{{tag.abbreviation}}</span>
            </div>

            <!-- <div *ngIf="screenXl" class="spell-expansion-properties" style="margin-left: 30px; width: 150px;">
              <span *ngIf="spell.concentration" matTooltip="{{spell.concentrationTooltip}}"
                matTooltipShowDelay="{{tooltipDelay}}">
                <img class="image" src={{images.spellConcentration}}>
              </span>
              {{spell.durationDisplayList}}
            </div> -->

          </div>


          <div *ngIf="i === expandedPanelIndex">
            <div class="spell-expansion-name">
              {{spell.name}}
            </div>
            <div class="spell-expansion-extra">
              {{spell.levelSchoolDisplay}}
            </div>
          </div>

          <!-- <div *ngIf="i != expandedPanelIndex" fxLayout="column" style="width: 10px">
            <div class="spell-expansion-header" style="font-size: larger;" fxLayout="row">
              <div style="width: 400px;">{{spell.name}}</div>
              <div style="font-size: medium;">{{spell.castingTime}}</div>
            </div>
            <div class="spell-expansion-header"
              style="font-size: small; font-style: italic; padding-left: 0.25rem; color:gray; ">
              {{spell.levelSchoolDisplay}}
            </div>
          </div>

          <div *ngIf="i === expandedPanelIndex">
            <div style="font-size: larger;">
              {{spell.name}}
            </div>
            <div style="font-size: small; font-style: italic; padding-left: 0.25rem; color:gray; ">
              {{spell.levelSchoolDisplay}}
            </div>
          </div> -->

        </mat-expansion-panel-header>

        <ng-template matExpansionPanelContent>
          <div>

            <div>
              <span class="spell-property-denotation">Casting time:</span>
              <span class="spell-property-description">{{spell.castingTime}}</span>
            </div>

            <div>
              <span class="spell-property-denotation">Range (Area):</span>
              <span class="spell-property-description">
                <ng-template [ngTemplateOutlet]="SpellRange"></ng-template>
              </span>
            </div>

            <div>
              <span class="spell-property-denotation">Components:</span>
              <span class="spell-property-description">{{spell.componentsDisplay}}</span>
            </div>

            <div>
              <span class="spell-property-denotation">Duration:</span>
              <span class="spell-property-description">{{spell.duration}}</span>
            </div>

            <div *ngIf="spell.castingAbility.toLowerCase() != 'unknown'">
              <span class="spell-property-denotation">Attack/Save:</span>
              <span class="spell-property-description">{{spell.attacksSavesDisplay}}</span>
            </div>

            <div>

              <!--shows known/prepared/always information-->
              <div *ngIf="settings.characterMode && characterData.selectedCharacter != undefined" fxLayout="row" fxLayoutAlign="end">
                
                <ng-template #icon let-show="show" let-iconFull="iconFull" let-iconEmpty="iconEmpty">
                  <span *ngIf="show"><mat-icon color="primary">{{iconFull}}</mat-icon></span>
                  <span *ngIf="!show"><mat-icon style="color: grey">{{iconEmpty}}</mat-icon></span>
                </ng-template>

                <!--used-->
                <div *ngIf="characterData.selectedCharacter.mode === ModeOption.Session">
                  <button color="primary" class="infobutton" mat-icon-button (click)="onUsed(spell)"
                    matTooltip="{{spell.prepared ? 'used' : 'not used'}}" matTooltipShowDelay="{{tooltipDelay}}">
                    <span *ngIf="spell.used"><mat-icon>pause_circle_filled</mat-icon></span>
                    <span *ngIf="!spell.used"><mat-icon>pause_circle_outline</mat-icon></span>
                  </button>
                </div>                            
                <!--known-->
                <div *ngIf="showIconKnown(spell)">
                  <button *ngIf="!disableIconKnownLists()" class="infobutton" mat-icon-button (click)="onKnown(spell)"
                    matTooltip="{{spell.known ? 'known' : 'not known'}}" matTooltipShowDelay="{{tooltipDelay}}">
                    <ng-template [ngTemplateOutlet]="icon" [ngTemplateOutletContext]="{show: spell.known, iconFull:'bookmark', iconEmpty: 'bookmark_border'}"></ng-template>  
                  </button>
                  <ng-template *ngIf="disableIconKnownLists()" [ngTemplateOutlet]="icon" [ngTemplateOutletContext]="{show: spell.known, iconFull:'bookmark', iconEmpty: 'bookmark_border'}"></ng-template>  
                </div>
                <!--ritualCasting-->
                <div *ngIf="showIconRitual(spell)">
                  <button *ngIf="!disableIconKnownLists()" class="infobutton" mat-icon-button (click)="onRitual(spell)"
                    matTooltip="{{spell.ritualCast ? 'ritual cast' : 'not ritual cast'}}" matTooltipShowDelay="{{tooltipDelay}}">
                    <ng-template [ngTemplateOutlet]="icon" [ngTemplateOutletContext]="{show: spell.ritualCast, iconFull:'menu_book', iconEmpty: 'import_contacts'}"></ng-template>                  
                  </button>
                  <ng-template *ngIf="disableIconKnownLists()" [ngTemplateOutlet]="icon" [ngTemplateOutletContext]="{show: spell.ritualCast, iconFull:'menu_book', iconEmpty: 'import_contacts'}"></ng-template>  
                </div>
                <!--limited-->
                <div *ngIf="showIconLimited(spell)">
                  <button *ngIf="!disableIconKnownLists()" class="infobutton" mat-icon-button (click)="onLimited(spell)"
                    matTooltip="{{spell.limited ? 'limited' : 'not limited'}}" matTooltipShowDelay="{{tooltipDelay}}">
                    <ng-template [ngTemplateOutlet]="icon" [ngTemplateOutletContext]="{show: spell.limited, iconFull:'repeat_one_on', iconEmpty: 'repeat_one'}"></ng-template> 
                  </button>
                  <ng-template *ngIf="disableIconKnownLists()" [ngTemplateOutlet]="icon" [ngTemplateOutletContext]="{show: spell.limited, iconFull:'repeat_one_on', iconEmpty: 'repeat_one'}"></ng-template>  
                </div>
                <!--always-->
                <div *ngIf="showIconAlways(spell)">
                  <button *ngIf="!disableIconKnownLists()" class="infobutton" mat-icon-button (click)="onAlways(spell)"
                    matTooltip="{{spell.always ? 'special' : 'not special'}}" matTooltipShowDelay="{{tooltipDelay}}">
                    <ng-template [ngTemplateOutlet]="icon" [ngTemplateOutletContext]="{show: spell.always, iconFull:'star', iconEmpty: 'star_border'}"></ng-template> 
                  </button>
                  <ng-template *ngIf="disableIconKnownLists()" [ngTemplateOutlet]="icon" [ngTemplateOutletContext]="{show: spell.always, iconFull:'star', iconEmpty: 'star_border'}"></ng-template>  
                </div>
                <!--prepared-->
                <div *ngIf="showIconPrepared(spell)">
                  <button *ngIf="!disableIconPrepared()" class="infobutton" mat-icon-button (click)="onPreparation(spell)"
                    matTooltip="{{spell.prepared ? 'prepared' : 'not prepared'}}" matTooltipShowDelay="{{tooltipDelay}}">
                    <ng-template [ngTemplateOutlet]="icon" [ngTemplateOutletContext]="{show: spell.prepared, iconFull:'label', iconEmpty: 'label_outline'}"></ng-template> 
                  </button>
                  <ng-template *ngIf="disableIconPrepared()" [ngTemplateOutlet]="icon" [ngTemplateOutletContext]="{show: spell.prepared, iconFull:'label', iconEmpty: 'label_outline'}"></ng-template>  
                </div> 

              </div>

              <div>
                <div *ngIf="!settings.characterMode || characterData.selectedCharacter === undefined || !(showIconKnown(spell) || showIconAlways(spell) || showIconLimited(spell) || showIconRitual(spell) || showIconPrepared(spell))" class="big-top-gap" ></div>
                <div [innerHTML]="spell.descriptionDisplay"></div>    
              </div>

            </div>

            
            <div *ngIf="!spell.translatable" class="medium-top-gap">
              <div class="source-style">
                &#8226; {{spell.source}} &#8226;
              </div>
              <div class="medium-top-gap">
                <mat-divider></mat-divider>
              </div>
            </div>

            <div *ngIf="spell.translatable">
              <div fxLayout="row" fxLayoutAlign="space-between center">
                <div class="source-style">&#8226; {{spell.source}} &#8226;</div>
                <div>
                  <button color="primary" mat-button (click)="onTranslation(spell)">
                    <mat-icon>translate</mat-icon>
                  </button>
                </div>              
              </div>
              <div>
                <mat-divider></mat-divider>
              </div>
            </div>

            <div class="big-top-gap">
              <span class="spell-property-denotation">Classes:</span>
              <mat-chip-list>
                <mat-chip class="spell-class-chip" *ngFor="let spellClass of spell.classes">
                  {{spellClass.name}}
                </mat-chip>
              </mat-chip-list>
              <!-- <span class="spell-property-denotation">Classes:</span>
              <span class="spell-property-description">{{spell.classesDisplay}}</span> -->
            </div>

            <div class="medium-top-gap" *ngIf="spell.subclasses.length">
              <div class="spell-property-denotation">Subclasses:</div>
              <mat-chip-list>
                <mat-chip class="spell-class-chip" *ngFor="let spellSubclass of spell.subclasses" [selectable]=false>
                  {{spellSubclass.name}}
                </mat-chip>
              </mat-chip-list>
              <!-- <span class="spell-property-denotation">Subclasses:</span> -->
              <!-- <span class="spell-property-description">{{spell.subclassesDisplay}}</span> -->
            </div>
                       

            <div class="big-top-gap" *ngIf="showTags && spell.tags.length">
              
              <div>
                <mat-divider></mat-divider>
              </div>

              <div class="medium-top-gap">
                <mat-chip-list>
                  <mat-chip class="spell-tag-chip" *ngFor="let spellTag of spell.tags" selectable="false" selected
                    [style.background]="spellTag.colorCode" [style.color]="spellTag.fontColor" [matTooltip]="spellTag.description">
                    {{spellTag.name}}
                  </mat-chip>
                </mat-chip-list>
              </div>

            </div>   

            <div *ngIf="spell.asset" class="big-top-gap">
              <img src={{spell.assetPath}} style="max-width: 100%; margin-right: 1rem;"/>
            </div>
            <!-- <div *ngIf="spell.asset" >
              <div style="display: none;">
                <img src={{spell.assetPath}} (error)="spellAssetNotLoaded(i, spell.assetPath)"/>
              </div>
              <div *ngIf="i != assetNotLoadedIndex" class="big-top-gap">
                <img src={{spell.assetPath}} style="max-width: 100%; margin-right: 1rem;"/>
              </div>
            </div> -->
            

          </div>
        </ng-template>

      </mat-expansion-panel>

    </mat-accordion>


  </div>
</div>
